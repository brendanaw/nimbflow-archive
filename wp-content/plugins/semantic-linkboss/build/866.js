"use strict";(globalThis.webpackChunksemantic_linkboss=globalThis.webpackChunksemantic_linkboss||[]).push([[866],{6866:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var s=r(1609),a=r(7723),o=r(1083),n=r(8465),i=r.n(n),c=function(e,t){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},c(e,t)};function l(e){var t=e.className,r=e.counterClockwise,a=e.dashRatio,o=e.pathRadius,n=e.strokeWidth,i=e.style;return(0,s.createElement)("path",{className:t,style:Object.assign({},i,u({pathRadius:o,dashRatio:a,counterClockwise:r})),d:d({pathRadius:o,counterClockwise:r}),strokeWidth:n,fillOpacity:0})}function d(e){var t=e.pathRadius,r=e.counterClockwise?1:0;return"\n      M 50,50\n      m 0,-"+t+"\n      a "+t+","+t+" "+r+" 1 1 0,"+2*t+"\n      a "+t+","+t+" "+r+" 1 1 0,-"+2*t+"\n    "}function u(e){var t=e.counterClockwise,r=e.dashRatio,s=e.pathRadius,a=2*Math.PI*s,o=(1-r)*a;return{strokeDasharray:a+"px "+a+"px",strokeDashoffset:(t?-o:o)+"px"}}var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function __(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}(t,e),t.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},t.prototype.getPathRadius=function(){return 50-this.props.strokeWidth/2-this.getBackgroundPadding()},t.prototype.getPathRatio=function(){var e=this.props,t=e.value,r=e.minValue,s=e.maxValue;return(Math.min(Math.max(t,r),s)-r)/(s-r)},t.prototype.render=function(){var e=this.props,t=e.circleRatio,r=e.className,a=e.classes,o=e.counterClockwise,n=e.styles,i=e.strokeWidth,c=e.text,d=this.getPathRadius(),u=this.getPathRatio();return(0,s.createElement)("svg",{className:a.root+" "+r,style:n.root,viewBox:"0 0 100 100","data-test-id":"CircularProgressbar"},this.props.background?(0,s.createElement)("circle",{className:a.background,style:n.background,cx:50,cy:50,r:50}):null,(0,s.createElement)(l,{className:a.trail,counterClockwise:o,dashRatio:t,pathRadius:d,strokeWidth:i,style:n.trail}),(0,s.createElement)(l,{className:a.path,counterClockwise:o,dashRatio:u*t,pathRadius:d,strokeWidth:i,style:n.path}),c?(0,s.createElement)("text",{className:a.text,style:n.text,x:50,y:50},c):null)},t.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},t}(s.Component);function g(e){return Object.keys(e).forEach((function(t){null==e[t]&&delete e[t]})),e}var h=r(513),m=r(982),y=r(6188);const f=({isWizard:e=!1})=>{const{resetQuery:t}=(0,s.useContext)(h.B),{triggerRefresh:r}=(0,s.useContext)(h.B),[n,c]=(0,s.useState)(!1),[l,d]=(0,s.useState)([]),[u,f]=(0,s.useState)([]),[k,b]=(0,s.useState)(0),[_,x]=(0,s.useState)(!1),[w,C]=(0,s.useState)(0),v=async t=>{try{const s=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"prepare_batch_for_sync"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if(e||r(),400===s?.data?.data?.srv_status?.status)return void i().fire({icon:"error",title:"Error",html:s?.data?.data?.srv_status?.msg});if("yes"===s?.data?.data?.has_batch){const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}}),r="urls"===e?.data?.reports?.sync_method,a=r?e?.data?.reports?.urls:0;if(r&&a>0){const t=(e?.data?.reports?.sync_done||0)/a*100;b(Math.round(100*t)/100)}else{let e=(t-s?.data?.data?.batch_length)/t*100;b(Math.round(100*e)/100)}await v(t)}else d((e=>[...e,"Sync Completed"])),b(100),P()}catch(e){i().fire({icon:"error",title:"Error",text:"Error preparing queue. Please try again."}),console.error("Error preparing queue:",e)}},P=async()=>{try{const t=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"sync_finish"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});"success"===t?.data?.status?(d((e=>[...e,"Category Sync Finished","Syncing Finished"])),d((e=>[...e,"Sync Finished"])),i().fire({icon:"success",title:t?.data?.title,html:t?.data?.message,timer:3e3,timerProgressBar:!0}),C(!0),e&&setTimeout((()=>{localStorage.setItem("linkboss_setup_wizard_step",2)}),1500),r()):i().fire({icon:"error",title:t?.data?.title,html:t?.data?.message})}catch(e){console.error("Error finishing sync:",e)}};return(0,s.useEffect)((()=>{(async()=>{try{const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts-2"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});let t=e?.data?.reports?.sync_done,r=e?.data?.reports?.sync_remaing,s=t/(t+r)*100||0;n||b(Math.round(100*s)/100),f(e?.data?.reports)}catch(e){throw console.error("Error fetching reports:",e),e}})()}),[w,t]),(0,s.createElement)("div",{className:"flex items-center justify-center w-full mt-8"},(0,s.createElement)("div",{className:"relative flex flex-col items-center justify-center w-full border-2 border-gray-300 border-dashed rounded-lg dark:bg-gray-900 dark:border-gray-600"},(0,s.createElement)("div",{className:"flex flex-col items-center justify-center pt-20 pb-20 px-4"},(0,s.createElement)(p,{value:k,text:`${k}%`,className:"w-36 h-36 mb-6",styles:(E={pathColor:`rgba(88, 80, 236, ${k/100})`,textColor:"#5850ec",trailColor:"#d6d6d6"},N=E.rotation,S=E.strokeLinecap,B=E.textColor,R=E.textSize,L=E.pathColor,W=E.pathTransition,O=E.pathTransitionDuration,A=E.trailColor,j=E.backgroundColor,M=null==N?void 0:"rotate("+N+"turn)",T=null==N?void 0:"center center",{root:{},path:g({stroke:L,strokeLinecap:S,transform:M,transformOrigin:T,transition:W,transitionDuration:null==O?void 0:O+"s"}),trail:g({stroke:A,strokeLinecap:S,transform:M,transformOrigin:T}),text:g({fill:B,fontSize:R}),background:g({fill:j})})}),(0,s.createElement)("p",{className:"mb-4 text-sm text-gray-500 dark:text-white"},(0,s.createElement)("span",{className:"font-semibold"},(0,a.__)("Click the Sync Now","semantic-linkboss"))," ",(0,a.__)("button for syncing the prepared contents, process may take a while.","semantic-linkboss")),(0,s.createElement)("div",{className:"flex items-center"},(0,s.createElement)("input",{type:"checkbox",className:"w-4 h-4 m-0 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",checked:_,onChange:e=>x(e.target.checked)}),(0,s.createElement)("label",{className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"},(0,a.__)("Force Sync - ","semantic-linkboss"),(0,s.createElement)("a",{className:"text-blue-600 dark:text-blue-500 hover:underline ml-1"},(0,a.__)("(to Sync all posts)","semantic-linkboss")),".")),(0,s.createElement)("div",{className:"flex items-center justify-center mt-6"},(0,s.createElement)("button",{className:"flex items-center gap-2 rounded-md bg-indigo-700 py-3 px-6 border text-sm font-bold text-white transition-all shadow-md hover:shadow-lg focus:bg-indigo-700 active:bg-indigo-700 hover:bg-indigo-800 disabled:pointer-events-none disabled:opacity-50 dark:border-indigo-700",onClick:async()=>{if(d([]),c(!0),u?.queue_remaining>0)try{console.log("Preparing queue..."),await(async()=>{try{for(;;){const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init/set",{action:"init_posts_ids_batch"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if(await r(),d([`Preparing... ${u?.queue_remaining} posts left.`]),!0!==e?.data?.has_post){console.log("Queue completed."),d((e=>[...e,"Queue preparation completed."]));break}}}catch(e){throw d((e=>[...e,"Error preparing queue..."])),console.error("Error preparing queue:",e),e}})(),console.log("Queue preparation completed.")}catch(e){return console.error("Queue preparation failed:",e),void d((e=>[...e,"Queue preparation failed."]))}if(100===k&&!_)return i().fire({icon:"info",title:"Sync Completed",text:"Your data is already synced.",timer:3e3,timerProgressBar:!0}),e&&setTimeout((()=>{localStorage.setItem("linkboss_setup_wizard_step",2),r()}),3e3),void c(!1);try{console.log("Starting sync..."),await(async()=>{try{const e=await(async()=>{try{const e=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/init",{action:"init_batch_reports",who:"syncPosts"},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}}),t="urls"===e?.data?.reports?.sync_method;return{posts:t?e?.data?.reports?.urls:e?.data?.reports?.posts,pages:t?0:e?.data?.reports?.pages,category:e?.data?.reports?.total_categories,sync_done:e?.data?.reports?.sync_done,sync_method:e?.data?.reports?.sync_method}}catch(e){throw console.error("Error fetching reports:",e),e}})();await(async e=>{try{const t=await o.A.post(LinkBossConfig?.rest_url+"linkboss/v1/sync",{action:"sync_init",force_data:_?"yes":"no",...e},{headers:{"X-WP-Nonce":LinkBossConfig.nonce}});if("success"===t?.data?.status){d((e=>[...e,"Syncing ...","Sync Initiated","Syncing Posts..."]));let e=t?.data?.batch?.length;d((e=>[...e,"Processing batches..."])),await v(e)}else i().fire({icon:"error",title:t?.data?.title,text:t?.data?.message})}catch(e){throw i().fire({icon:"error",title:"Error",text:e?.response?.data.message}),e}})(e)}catch(e){if(console.error("Error syncing posts:",e),"rest_no_route"===e?.response?.data?.code)return void i().fire({title:"Oops!",text:(0,a.__)("Please connect your WordPress site with LinkBoss app by adding the API key from Settings.","semantic-linkboss"),icon:"info",showCancelButton:!0,confirmButtonText:"API Settings",cancelButtonText:"Cancel"}).then((e=>{e.isConfirmed&&(window.location.href="admin.php?page=semantic-linkboss#settings")}));i().fire({icon:"info",title:"Oops!",text:e?.response?.data?.message+" - "+e?.response?.data?.code})}})(),console.log("Sync completed successfully.")}catch(e){console.error("Error during sync process:",e),d((e=>[...e,"Error during sync process"]))}finally{c(!1)}},disabled:n},(0,s.createElement)(m.g,{icon:y.rk5}),n?(0,a.__)("Syncing...","semantic-linkboss"):(0,a.__)("Sync Now","semantic-linkboss")))),(0,s.createElement)("div",{className:"absolute top-0 right-0 p-3"},(0,s.createElement)("ul",{className:"max-w-md space-y-1 text-gray-500 list-inside dark:text-gray-400"},l.map(((e,t)=>(0,s.createElement)("li",{key:t,className:"flex items-center"},(0,s.createElement)(m.g,{icon:y.SGM,className:"w-3.5 h-3.5 me-2 text-green-500 dark:text-green-400 shrink-0"}),e)))))));var E,N,S,B,R,L,W,O,A,j,M,T}}}]);